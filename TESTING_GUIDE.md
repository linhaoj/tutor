# 本地测试指南 - 多用户功能验证

## 🚀 环境状态

### 当前运行状态
- ✅ **后端**: http://localhost:8000 (正在运行)
- ✅ **前端**: http://localhost:5173 (正在运行)
- ✅ **数据库**: english_tutor.db (已初始化)

---

## 📋 测试流程

### 1. 登录测试

**打开浏览器访问**: http://localhost:5173

**默认管理员账号**:
```
用户名: admin
密码: admin123
```

**测试点**:
- [ ] 正确密码可以登录
- [ ] 错误密码提示错误
- [ ] 登录成功后跳转到日程管理页面
- [ ] Token自动保存到localStorage

---

### 2. 多用户数据隔离测试

**步骤**:

1. **使用管理员账号创建两个教师账号**

   进入"系统管理"页面,创建:
   ```
   教师A:
   - 用户名: teacher1
   - 密码: 123456
   - 显示名称: 张老师

   教师B:
   - 用户名: teacher2
   - 密码: 123456
   - 显示名称: 李老师
   ```

2. **分别登录测试数据隔离**

   - 打开Chrome正常窗口,以teacher1登录
   - 打开Chrome隐身窗口,以teacher2登录

3. **创建测试数据**

   **张老师创建**:
   - 学生: 小明 (剩余课时: 10小时)
   - 单词集: 张老师单词集
   - 课程: 2025-10-16 10:00 小明单词学习

   **李老师创建**:
   - 学生: 小红 (剩余课时: 8小时)
   - 单词集: 李老师单词集
   - 课程: 2025-10-16 14:00 小红单词学习

4. **验证数据隔离**

   **测试点**:
   - [ ] 张老师只能看到"小明",看不到"小红"
   - [ ] 李老师只能看到"小红",看不到"小明"
   - [ ] 单词集全局共享(两个老师都能看到对方的单词集)
   - [ ] 课程安排按教师隔离

---

### 3. 学生管理CRUD测试

**进入"学生管理"页面**

**测试点**:
- [ ] 创建学生(姓名、邮箱、课时)
- [ ] 编辑学生信息
- [ ] 扣减课时(测试1.0h和0.5h)
- [ ] 删除学生
- [ ] 刷新页面数据依然存在

**特殊测试**:
- [ ] 尝试扣减超过剩余课时 → 应该提示错误
- [ ] 尝试一次性扣减15小时 → 应该提示"单次扣减不能超过10小时"

---

### 4. 单词管理测试

**进入"单词管理"页面**

**测试点**:
- [ ] 创建单词集
- [ ] 添加单词到单词集
- [ ] 删除单词
- [ ] Excel批量导入(如果有Excel文件)
- [ ] 单词集在多用户间可见(全局共享)

---

### 5. 课程安排测试

**进入"日程管理"页面**

**测试点**:
- [ ] 创建新课程(选择学生、日期、时间、单词集)
- [ ] 课程按日期分组显示
- [ ] 标记课程完成
- [ ] 删除课程
- [ ] 点击"学习"按钮进入学习页面

---

### 6. Token过期测试

**步骤**:

1. 正常登录系统
2. 手动删除localStorage中的`auth_token`
3. 刷新页面或进行任何操作

**测试点**:
- [ ] 自动跳转到登录页面
- [ ] 提示"请先登录"

---

### 7. 并发操作测试

**步骤**:

1. 使用两个浏览器窗口,用同一个账号登录
2. 在窗口A创建一个学生"测试A"
3. 在窗口B创建一个学生"测试B"
4. 在两个窗口中分别刷新学生列表

**测试点**:
- [ ] 两个窗口都能看到"测试A"和"测试B"
- [ ] 数据没有丢失或冲突

---

### 8. 错误处理测试

**测试点**:
- [ ] 网络断开时提示错误
- [ ] 表单验证正常工作
- [ ] 后端错误有友好提示

---

## 🔍 后端API直接测试

如果前端有问题,可以直接测试后端API:

### 登录
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin&password=admin123"
```

### 获取当前用户信息
```bash
TOKEN="your_token_here"
curl http://localhost:8000/api/auth/me \
  -H "Authorization: Bearer $TOKEN"
```

### 获取学生列表
```bash
curl http://localhost:8000/api/students \
  -H "Authorization: Bearer $TOKEN"
```

### 创建学生
```bash
curl -X POST http://localhost:8000/api/students \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "测试学生", "remaining_hours": 10}'
```

---

## ✅ 测试通过标准

所有以下检查项都应该通过:

### 认证系统
- [x] 管理员可以登录
- [ ] JWT token正常工作
- [ ] Token过期自动跳转登录
- [ ] 用户权限验证正确

### 数据隔离
- [ ] 不同教师看不到对方的学生
- [ ] 不同教师看不到对方的课程
- [ ] 单词集全局共享
- [ ] 学习进度按教师隔离

### CRUD操作
- [ ] 学生增删改查正常
- [ ] 单词增删改查正常
- [ ] 课程增删改查正常
- [ ] 数据持久化到数据库

### 业务规则
- [ ] 课时扣减逻辑正确
- [ ] 不能扣减负数课时
- [ ] 单次扣减不超过10小时
- [ ] 不能删除自己的账号

---

## 🐛 已知问题

### 如果遇到问题:

1. **401 Unauthorized**
   - 清除浏览器localStorage
   - 重新登录获取新token

2. **CORS错误**
   - 检查后端CORS配置
   - 确保前端API地址正确(http://localhost:8000)

3. **数据库锁定**
   - 重启后端服务器
   - 删除english_tutor.db重新初始化

4. **Token过期**
   - Token有效期30天,过期需重新登录

---

## 📊 测试报告模板

完成测试后记录结果:

```
测试日期: ____________________
测试人员: ____________________

【登录测试】
✅ / ❌ 管理员登录
✅ / ❌ 教师登录
✅ / ❌ Token验证

【数据隔离测试】
✅ / ❌ 学生数据隔离
✅ / ❌ 课程数据隔离
✅ / ❌ 单词集全局共享

【CRUD测试】
✅ / ❌ 学生管理
✅ / ❌ 单词管理
✅ / ❌ 课程管理

【业务规则测试】
✅ / ❌ 课时扣减
✅ / ❌ 权限验证
✅ / ❌ 数据验证

【发现的问题】
1. ___________________________
2. ___________________________
3. ___________________________

【总体评价】
□ 所有功能正常,可以部署
□ 有小问题,需要修复
□ 有严重问题,不能部署
```

---

**祝测试顺利!如有问题,请查看控制台错误信息并反馈给开发人员。**
